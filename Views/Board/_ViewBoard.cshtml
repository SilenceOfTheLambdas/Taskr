@model Board

<div class="row flex-row">

    @foreach (Swimlane swimlane in Model.Swimlanes)
    {
        <div class="col flex-column border border-dark-subtle rounded" style="margin: 1rem">
            <h2 class="mb-3">@swimlane.Name</h2>
            <div class="d-flex flex-column gap-2 mb-3">
                @foreach (Card card in swimlane.Cards)
                {
                    <div class="p-2 bg-light-subtle border border-dark-subtle rounded">
                        <div class="fw-bold">@card.Title</div>
                        <div class="small text-muted">@card.Description</div>
                    </div>
                }
            </div>
            <div class="container p-0">
                <button class="btn btn-sm btn-outline-primary w-100">New Card</button>
            </div>
        </div>
    }
    @* New Swimlane Button *@
    <div class="col-md-auto rounded" style="margin: 1rem">
        <div class="container p-0">
            <button id="add-swimlane-btn" class="btn btn-sm btn-outline-primary w-20">+</button>
            <form id="add-swimlane-form" class="form-text d-none" name="swimlaneName">
                <input type="text" name="swimlaneName" id="swimlane-name-input" class="form-control form-control-sm" placeholder="New Swimlane" autofocus>
            </form>
        </div>
    </div>
</div>

<script>
    const addBtn = document.getElementById('add-swimlane-btn');
    const form = document.getElementById('add-swimlane-form');
    const input = document.getElementById('swimlane-name-input');
    
    // Show input when the + button is pressed
    addBtn.addEventListener('click', () => {
        addBtn.classList.add('d-none');
        form.classList.remove('d-none');
        input.focus();
    })
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault()
        
        const swimlaneName = input.value;
        const response = await fetch(`/Swimlane/CreateNewSwimlane?swimlaneName=${encodeURIComponent(swimlaneName)}`, {
            method: 'POST'
        });
        
        if (response.status === 201) {
            // Redirect
            window.location.href = '/';
        } else {
            // An error has occurred
            console.error("Creation of Swimlane failed", response.status)
        }
    });
</script>